# Диаграмма последовательности системная (с классами)

## Диаграмма последовательности: Подача заявки пользователем

![image](https://github.com/user-attachments/assets/9489494b-fb6f-4fd5-8bb4-c7b238d3d274)


### Основной сценарий:
 - Пользователь вызывает метод submitApplication контроллера UserController.
 - Контроллер вызывает метод createApplication у ApplicationService, передавая userId и serviceId.
 - ApplicationService запрашивает данные пользователя через UserService по ID.
 - UserService обращается к UserRepository, который делает запрос в БД: SELECT * FROM User WHERE id = userId.
 - БД возвращает данные пользователя.
 - ApplicationService выполняет валидацию пользователя с помощью метода validateUser.
 - Затем ApplicationService получает данные сервиса через ServiceRepository, делая запрос в БД: SELECT * FROM Service 
   WHERE id = serviceId.
 - ApplicationService валидирует полученный сервис с помощью метода validateService.
 - Если данные валидны:
 - Создаётся объект заявки.
 - ApplicationRepository сохраняет заявку в БД с запросом INSERT INTO Application.
 - БД подтверждает сохранение.
 - UserController возвращает пользователю сообщение: "Заявка создана".
 - Если данные невалидны:
 - ApplicationService возвращает сообщение об ошибке.
 - UserController возвращает пользователю сообщение: "Ошибка: невалидные данные".
 
## Диаграмма последовательности: Изменение персональных параметров 

![image](https://github.com/user-attachments/assets/e69c5743-5114-47b7-810b-738d50293689)





### Основной сценарий:
 - Пользователь вызывает метод updatePersonalData контроллера UserController, передавая userId и новые данные newData.
 - Контроллер вызывает метод updateUser у UserService.
 - UserService выполняет валидацию новых данных через метод validate.
 - Если данные валидны:
 - UserService запрашивает пользователя по ID через UserRepository.
 - UserRepository делает запрос в БД: SELECT User WHERE id = userId.
 - БД возвращает пользователя.
 - UserRepository передаёт данные пользователя обратно в UserService.
 - UserService обновляет данные пользователя и передаёт обновлённый объект в UserRepository.
 - UserRepository выполняет запрос UPDATE User в БД.
 - БД подтверждает обновление и возвращает обновлённого пользователя.
 - UserRepository передаёт обновлённого пользователя обратно в UserService.
 - UserService возвращает результат в UserController.
 - UserController отправляет пользователю сообщение: "Данные обновлены".
 - Если данные невалидны:
 - UserService возвращает сообщение об ошибке в UserController.
 - UserController отправляет пользователю сообщение: "Ошибка".





## Диаграмма последовательности: Отмена заявки 

![image](https://github.com/user-attachments/assets/483a5855-ab93-4765-8842-595d659318d3)





### Основной сценарий:
 - Пользователь вызывает метод cancelApplication(appId) у контроллера UserController.
 - UserController вызывает метод cancelApplication(appId) у ApplicationService.
 - ApplicationService обращается к ApplicationRepository с методом findById(appId) для получения заявки.
 - ApplicationRepository выполняет запрос в БД: SELECT Application WHERE id = appId.
 - БД возвращает найденную заявку в ApplicationRepository.
 - ApplicationRepository передаёт заявку обратно в ApplicationService.
 - ApplicationService выполняет проверку возможности отмены заявки через метод validateCancellation(app).
 - Если заявка найдена и допустима для отмены:
 - ApplicationService обновляет статус заявки на CANCELED.
 - ApplicationService вызывает метод update(app) у ApplicationRepository.
 - ApplicationRepository выполняет запрос в БД: UPDATE Application SET status='CANCELED'.
 - БД возвращает подтверждение и обновлённую заявку.
 - Обновлённая заявка передаётся обратно в ApplicationService, затем в UserController.
 - UserController отправляет пользователю сообщение: "Заявка отменена".
 - Если заявка не найдена или не может быть отменена:
 - ApplicationService возвращает сообщение об ошибке в UserController.
 - UserController отправляет пользователю сообщение: "Ошибка: Заявка не найдена или не может быть отменена".




## Диаграмма последовательности: Просмотр списка услуг
![image](https://github.com/user-attachments/assets/3ae3543c-5403-4650-8e10-0a8ecc5314b9)




### Основной сценарий:
 - Пользователь отправляет запрос getAvailableServices() в UserController для получения списка доступных услуг.
 - UserController вызывает метод getActiveServices() у UserService.
 - UserService обращается к ServiceRepository, вызывая метод findByActiveTrue(), чтобы получить список всех услуг с 
   признаком active = true.
 - ServiceRepository выполняет SQL-запрос к БД:
 - SELECT * FROM Service WHERE active = true.
 - БД возвращает найденные услуги в ServiceRepository.
 - ServiceRepository передаёт список услуг в UserService.
 - UserService выполняет валидацию полученного списка с помощью метода validateServices().
 - Альтернативные ветки:
 - Если данные валидны:
 - UserService возвращает список услуг в UserController.
 - UserController отправляет пользователю ответ: "Список доступных услуг".
 - Если данные невалидны:
 - UserService возвращает сообщение об ошибке в UserController.
 - UserController отправляет пользователю сообщение: "Ошибка: Невалидные данные".



## Диаграмма последовательности: Просмотр статуса 
![image](https://github.com/user-attachments/assets/23af7b66-6b44-4580-acc9-65394fade65c)




### Основной сценарий:
 - Пользователь вызывает метод getStatus(appId) у контроллера UserController.
 - Контроллер вызывает метод getApplicationStatus(appId) у ApplicationService.
 - ApplicationService запрашивает заявку через ApplicationRepository с использованием метода findById(appId).
 - Если заявка найдена:
 - ApplicationRepository выполняет запрос в БД: SELECT Application WHERE id=appId.
 - БД возвращает заявку.
 - Статус заявки передается в UserController.
 - Контроллер возвращает пользователю статус заявки (например, "Статус: В обработке").
 - Если заявка не найдена:
 - ApplicationRepository возвращает null (заявка не найдена).
 - ApplicationService сообщает контроллеру, что заявка не найдена.
 - Контроллер возвращает пользователю сообщение об ошибке: "Ошибка: не найдена".


 

## Диаграмма последовательности: Добавление правила со сторони администратора

![image](https://github.com/user-attachments/assets/8bf42b71-5a86-4156-af5e-5963c67beda1)






### Основной сценарий:
 - Administrator отправляет запрос addRule(serviceId, ruleData) в контроллер AdminController.
 - AdminController вызывает метод addRule(serviceId, ruleData) у сервиса :AdminService.
 - AdminService обращается к :ServiceRepository, вызывая метод findById(serviceId) для поиска сервиса по ID.
 - ServiceRepository выполняет SQL-запрос в БД:
 - SELECT * FROM Service WHERE id = serviceId.
 - БД возвращает найденный сервис в :ServiceRepository.
 - ServiceRepository передаёт сервис обратно в :AdminService.
 - AdminService выполняет валидацию полученного сервиса с помощью метода validateService(service).
 - Альтернативные сценарии:
 - Сервис не найден
 - AdminService возвращает ServiceNotFoundException в :AdminController.
 - AdminController сообщает администратору: "Ошибка: Сервис не найден".
 - Сервис архивный
 - AdminService возвращает ArchivedServiceException в :AdminController.
 - AdminController сообщает администратору: "Ошибка: Сервис архивный".
 - Сервис валиден
 - AdminService вызывает метод save(newRule) у :RuleRepository, чтобы сохранить новое правило.
 - RuleRepository выполняет SQL-запрос:
 - INSERT INTO Rule.
 - БД возвращает сохранённое правило в :RuleRepository.
 - RuleRepository возвращает его в :AdminService.
 - AdminService выполняет валидацию переданных данных правила с помощью validateRuleData(ruleData).
 - Альтернативы при валидации данных правила:
 - Данные корректны
 - AdminService возвращает правило в :AdminController.
 - AdminController сообщает администратору: "Правило добавлено".
 - Данные некорректны
 - AdminService возвращает InvalidRuleDataException в :AdminController.
 - AdminController сообщает администратору: "Ошибка: Некорректные данные".

## Диаграмма последовательности: Обработка заявки госслужащим

![image](https://github.com/user-attachments/assets/2a9d51ee-b9ca-4378-aaeb-f9d823119e83)





### Основной сценарий:
 - Инициация запроса:
 - GovernmentEmployee инициирует обработку заявки, вызывая метод processApplication(appId) в :GovernmentController.
 - Контроллер передает запрос на обработку в :GovernmentService.
 - Промежуточная валидация:
 - GovernmentService запрашивает информацию о заявке из :ApplicationRepository с использованием findById(appId).
 - Запрос к базе данных выполняется для извлечения данных о заявке по её идентификатору.
 - Затем происходит проверка статуса заявки с помощью метода validateApplicationStatus(заявка) в :GovernmentService.
 - Альтернативные ветви:
 - Если статус заявки допустим, продолжается обработка:
 - GovernmentService вызывает :AdminService для валидации заявки через метод validateApplication(заявка).
 - AdminService запрашиваются правила для данного типа услуги из :RuleRepository.
 - Выполняется запрос к базе данных для извлечения списка правил, после чего происходит возврат этих правил в 
   AdminService.
 - После успешной валидации в :GovernmentService, статус заявки обновляется на "PROCESSED" с помощью 
   ApplicationRepository.
 - База данных обновляется, и информация о заявке возвращается в :GovernmentService.
 - Если статус заявки недопустим, то в :GovernmentService возвращается ошибка, и управление передается обратно в 
 - GovernmentController, который уведомляет GovernmentEmployee о невозможности обработки заявки из-за её недопустимого 
   статуса.
 - Ответ пользователю:
 - В случае успешной обработки заявки, GovernmentEmployee получает сообщение "Заявка обработана".
 - В случае ошибки (например, недопустимый статус заявки), GovernmentEmployee получает сообщение "Ошибка обработки 
   заявки".
 



 

