# Диаграмма последовательности системная (с классами)

## Диаграмма последовательности: Подача заявки пользователем

![image](https://github.com/user-attachments/assets/9489494b-fb6f-4fd5-8bb4-c7b238d3d274)


### Основной сценарий:
 - Пользователь вызывает метод submitApplication контроллера UserController.
 - Контроллер вызывает метод createApplication у ApplicationService, передавая userId и serviceId.
 - ApplicationService запрашивает данные пользователя через UserService по ID.
 - UserService обращается к UserRepository, который делает запрос в БД: SELECT * FROM User WHERE id = userId.
 - БД возвращает данные пользователя.
 - ApplicationService выполняет валидацию пользователя с помощью метода validateUser.
 - Затем ApplicationService получает данные сервиса через ServiceRepository, делая запрос в БД: SELECT * FROM Service 
   WHERE id = serviceId.
 - ApplicationService валидирует полученный сервис с помощью метода validateService.
 - Если данные валидны:
 - Создаётся объект заявки.
 - ApplicationRepository сохраняет заявку в БД с запросом INSERT INTO Application.
 - БД подтверждает сохранение.
 - UserController возвращает пользователю сообщение: "Заявка создана".
 - Если данные невалидны:
 - ApplicationService возвращает сообщение об ошибке.
 - UserController возвращает пользователю сообщение: "Ошибка: невалидные данные".
 
## Диаграмма последовательности: Изменение персональных параметров 

![image](https://github.com/user-attachments/assets/e69c5743-5114-47b7-810b-738d50293689)





### Основной сценарий:
 - Пользователь вызывает метод updatePersonalData контроллера UserController, передавая userId и новые данные newData.
 - Контроллер вызывает метод updateUser у UserService.
 - UserService выполняет валидацию новых данных через метод validate.
 - Если данные валидны:
 - UserService запрашивает пользователя по ID через UserRepository.
 - UserRepository делает запрос в БД: SELECT User WHERE id = userId.
 - БД возвращает пользователя.
 - UserRepository передаёт данные пользователя обратно в UserService.
 - UserService обновляет данные пользователя и передаёт обновлённый объект в UserRepository.
 - UserRepository выполняет запрос UPDATE User в БД.
 - БД подтверждает обновление и возвращает обновлённого пользователя.
 - UserRepository передаёт обновлённого пользователя обратно в UserService.
 - UserService возвращает результат в UserController.
 - UserController отправляет пользователю сообщение: "Данные обновлены".
 - Если данные невалидны:
 - UserService возвращает сообщение об ошибке в UserController.
 - UserController отправляет пользователю сообщение: "Ошибка".





## Диаграмма последовательности: Отмена заявки 

![image](https://github.com/user-attachments/assets/b81d8caa-0b29-4f1d-8f76-d0558679174f)




### Основной сценарий:
 - Пользователь вызывает метод cancelApplication у контроллера UserController, передавая appId.
 - Контроллер вызывает метод cancelApplication у ApplicationService.
 - ApplicationService выполняет валидацию возможности отмены заявки через метод validateCancellation.
 - Если заявка найдена и может быть отменена:
 - ApplicationService вызывает метод findById у ApplicationRepository.
 - ApplicationRepository выполняет запрос в БД: SELECT Application WHERE id = appId.
 - БД возвращает заявку.
 - Заявка передаётся обратно в ApplicationService.
 - ApplicationService обновляет статус заявки на CANCELED и передаёт обновлённую заявку в ApplicationRepository.
 - ApplicationRepository выполняет запрос UPDATE Application SET status='CANCELED' в БД.
 - БД подтверждает обновление и возвращает обновлённую заявку.
 - Обновлённая заявка передаётся обратно в ApplicationService, затем в UserController.
 - UserController возвращает пользователю сообщение: "Заявка отменена".
 - Если заявка не найдена или не может быть отменена:
 - ApplicationService возвращает сообщение об ошибке в UserController.
 - UserController отправляет пользователю сообщение: "Ошибка".


## Диаграмма последовательности: Просмотр списка услуг
![image](https://github.com/user-attachments/assets/3ae3543c-5403-4650-8e10-0a8ecc5314b9)




### Основной сценарий:
 - Пользователь вызывает метод getAvailableServices() у контроллера UserController.
 - Контроллер вызывает метод getActiveServices() у UserService.
 - UserService выполняет валидацию данных с помощью метода validateServices.
 - Если данные валидны:
 - UserService вызывает метод findByActiveTrue() у ServiceRepository.
 - ServiceRepository выполняет запрос в БД: SELECT Service WHERE active=true.
 - БД возвращает список активных услуг.
 - Список услуг передаётся обратно в UserService, а затем в UserController.
 - UserController возвращает пользователю список доступных услуг: "Список доступных услуг".
 - Если данные невалидны:
 - UserService сообщает контроллеру о некорректных данных.
 - UserController возвращает пользователю сообщение об ошибке: "Ошибка: Невалидные данные".




## Диаграмма последовательности: Просмотр статуса 
![image](https://github.com/user-attachments/assets/23af7b66-6b44-4580-acc9-65394fade65c)




### Основной сценарий:
 - Пользователь вызывает метод getStatus(appId) у контроллера UserController.
 - Контроллер вызывает метод getApplicationStatus(appId) у ApplicationService.
 - ApplicationService запрашивает заявку через ApplicationRepository с использованием метода findById(appId).
 - Если заявка найдена:
 - ApplicationRepository выполняет запрос в БД: SELECT Application WHERE id=appId.
 - БД возвращает заявку.
 - Статус заявки передается в UserController.
 - Контроллер возвращает пользователю статус заявки (например, "Статус: В обработке").
 - Если заявка не найдена:
 - ApplicationRepository возвращает null (заявка не найдена).
 - ApplicationService сообщает контроллеру, что заявка не найдена.
 - Контроллер возвращает пользователю сообщение об ошибке: "Ошибка: не найдена".


 

## Диаграмма последовательности: Добавление правила со сторони администратора

![image](https://github.com/user-attachments/assets/ea6183a6-7bd9-4f7d-b039-c6b209f223b3)




### Основной сценарий:
 - Администратор вызывает метод addRule в контроллере AdminController, передавая идентификатор услуги (serviceId) и 
   данные правила (ruleData).
 - Контроллер AdminController передает эти данные в сервис AdminService с помощью метода addRule.
 - В сервисе AdminService выполняется промежуточная валидация данных правила, включая проверку параметров.
 - Если данные правила некорректны, сервис сообщает контроллеру об ошибке и передает сообщение "Некорректные данные 
   правила".
 - Если данные корректны, сервис передает данные правила в репозиторий RuleRepository для сохранения.
 - Репозиторий RuleRepository выполняет запрос в БД для вставки нового правила с помощью команды INSERT Rule.
 - БД возвращает информацию о сохраненном правиле.
 - Репозиторий возвращает сохраненное правило в сервис AdminService.
 - Сервис AdminService передает результат контроллеру.
 - Контроллер AdminController сообщает администратору, что правило успешно добавлено, с сообщением "Правило добавлено".


## Диаграмма последовательности: Обработка заявки госслужащим

![image](https://github.com/user-attachments/assets/b2a098d5-78d3-45fa-a617-a6a21911d2f9)




### Основной сценарий:
 - Инициирование:
 - Сотрудник государственного органа вызывает метод processApplication(appId) у контроллера GovernmentController.
 - Передача в сервис:
 - Контроллер передает запрос в GovernmentService для дальнейшей обработки заявки.
 - Промежуточная валидация:
 - Внутри GovernmentService выполняется валидация статуса заявки через метод validateApplicationStatus(). Если статус 
   корректен, продолжается обработка.
 - Получение данных заявки:
 - GovernmentService запрашивает данные заявки через ApplicationRepository с использованием метода findById(appId).
 - ApplicationRepository выполняет запрос в БД для получения заявки по ID: SELECT * FROM Application WHERE id = appId.
 - БД возвращает данные заявки.
 - Валидация через сервис администратора:
 - Если статус заявки допустим, GovernmentService передает заявку в AdminService для дальнейшей валидации.
 - AdminService запрашивает список правил для услуги заявки через RuleRepository с запросом SELECT * FROM Rule WHERE 
   serviceId = заявка.serviceId.
 - БД возвращает список правил.
 - Обновление статуса заявки:
 - Если все проверки пройдены успешно, GovernmentService обновляет статус заявки на "PROCESSED" в 
   ApplicationRepository с запросом UPDATE Application SET status = 'PROCESSED' WHERE id = appId.
 - БД подтверждает успешное обновление статуса заявки.
 - Ответ пользователю:
 - GovernmentService возвращает информацию о обработанной заявке в GovernmentController.
 - Контроллер возвращает сотруднику государственного органа сообщение о том, что заявка обработана.
 - Если статус заявки недопустим:
 - Если статус заявки невалиден, то GovernmentService сообщает контроллеру, что заявка не может быть обработана.
 - Контроллер возвращает сотруднику сообщение о том, что заявка имеет недопустимый статус.




 

